use mydb;

CREATE TABLE SalesPerson(
    S_id int NOT NULL PRIMARY KEY,
    Name varchar(255),
    City varchar(255),
    Earning float(7,2)
);

CREATE TABLE CUSTOMER(
	C_id int NOT NULL PRIMARY KEY,
    Cust_Name varchar(255),
    City varchar(255),
    Grades_id int
);

CREATE TABLE ORDERS(
	Ord_No int NOT NULL PRIMARY KEY,
    Purchase_Amt int,
    Ord_Date varchar(10),
    C_id int REFERENCES CUSTOMER(C_id),
    S_id int REFERENCES SalesPerson(S_id)
);

INSERT INTO SalesPerson VALUES(1, 'Amit', 'Delhi', 25000);
INSERT INTO SalesPerson VALUES(2, 'Ankit', 'Pune', 15000);
INSERT INTO SalesPerson VALUES(3, 'Chandra', 'Ahmedabad', 10000);
INSERT INTO SalesPerson VALUES(4, 'Monica', 'Delhi', 35000);
INSERT INTO SalesPerson VALUES(5, 'Rohini', 'Bhopal', 25000);

INSERT INTO CUSTOMER VALUES(10, 'Manish', 'Ahmedabad', 1001);
INSERT INTO CUSTOMER VALUES(11, 'Nishanth', 'Chennai', 3001);
INSERT INTO CUSTOMER VALUES(12, 'Guru', 'Delhi', 4002);
INSERT INTO CUSTOMER VALUES(13, 'Sonia', 'Delhi', 2002);
INSERT INTO CUSTOMER VALUES(14, 'Sakshi', 'Lucknow', 4003);

INSERT INTO ORDERS VALUES(1, 5000, '04-MAY-17', 10, 1);
INSERT INTO ORDERS VALUES(2, 450, '20-JAN-17', 10, 2);
INSERT INTO ORDERS VALUES(3, 1000, '24-FEB-17', 13, 2);
INSERT INTO ORDERS VALUES(4, 3500, '13-APR-17', 14, 3);
INSERT INTO ORDERS VALUES(5, 550, '09-MAR-17', 12, 2);

SELECT * FROM SalesPerson;
SELECT * FROM Customer;
SELECT * FROM Orders;

SELECT COUNT(cust_name) FROM CUSTOMER WHERE GRADES_ID > (SELECT AVG(GRADES_ID) FROM CUSTOMER WHERE CITY = 'Delhi');

SELECT S.NAME, S.CITY 
FROM SALESPERSON S, (SELECT S_ID, COUNT(S_ID) AS NumCustomers FROM ORDERS GROUP BY C_ID) CRM
WHERE S.S_ID = CRM.S_ID AND CRM.NumCustomers > 1;

SELECT S.S_ID, S.NAME, C.CUST_NAME, S.Earning 
FROM SALESPERSON S, CUSTOMER C
WHERE S.CITY = C.CITY
UNION
SELECT S_ID, NAME, 'NO MATCH', Earning 
FROM SALESPERSON
WHERE NOT CITY = ANY (SELECT CITY FROM CUSTOMER) ORDER BY 2 DESC;
